\documentclass[times,specification,annotation]{itmo-student-thesis}
\linespread{1.5}
%% Опции пакета:
%% - specification - если есть, генерируется задание, иначе не генерируется
%% - annotation - если есть, генерируется аннотация, иначе не генерируется
%% - times - делает все шрифтом Times New Roman, собирается с помощью xelatex
%% - languages={...} - устанавливает перечень используемых языков. По умолчанию это {english,russian}.
%%                     Последний из языков определяет текст основного документа.

%% Делает запятую в формулах более интеллектуальной, например:
%% $1,5x$ будет читаться как полтора икса, а не один запятая пять иксов.
%% Однако если написать $1, 5x$, то все будет как прежде.
\usepackage{icomma}

%% Один из пакетов, позволяющий делать таблицы на всю ширину текста.
\usepackage{tabularx}

%% Данные пакеты необязательны к использованию в бакалаврских/магистерских
%% Они нужны для иллюстративных целей
%% Начало
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{filecontents}
\begin{filecontents}{bachelor-thesis.bib}

\end{filecontents}
%% Конец

%% Указываем файл с библиографией.
\addbibresource{bachelor-thesis.bib}

\begin{document}

\studygroup{M34391}
\title{Реализация TinkerPop инфраструктуры для WebGraph}
\author{Стародубцев Андрей Игоревич}{Стародубцев А.И.}
\supervisor{Аксенов Виталий Евгеньевич}{Аксенов В.Е.}{PhD, науки}{главный научный сотрудник Университета ИТМО}
\publishyear{2019}
%% Дата выдачи задания. Можно не указывать, тогда надо будет заполнить от руки.
\startdate{31}{января}{2022}
%% Срок сдачи студентом работы. Можно не указывать, тогда надо будет заполнить от руки.
\finishdate{15}{мая}{2022}
%% Дата защиты. Можно не указывать, тогда надо будет заполнить от руки.
\defencedate{9}{июня}{2022}

\addconsultant{Zacchiroli Stefano}{HDR, Full Professor}

\secretary{Штумпф С.А.}

%% Задание
%%% Техническое задание и исходные данные к работе
\technicalspec{Требуется реализовать инфраструктуру фреймворка для обработки графов Apache TinkerPop, позволяющую обрабатывать графы, сжатые фреймворком WebGraph. Это позволит обрабатывать графы очень больших размеров (десятки миллиардов вершин) при помощи экспрессивного доменно-ориентированного языка для обхода графов Gremlin. Для реализации требуется разработать программный слой, связывающий модели данных TinkerPop и WebGraph, реализовать структурные интерфейсы TinkerPop для WebGraph, добавить поддержку различных подходов к хранению свойств вершин/ребер, оценить производительность реализации на представляющих интерес запросах в конкретном домене (архив репозиториев Software Heritage), найти и исправить узкие места.}

%%% Содержание выпускной квалификационной работы (перечень подлежащих разработке вопросов)
\plannedcontents{TinkerPop - фреймворк изначально направленный на использование в графовых базах данных. При реализации для сжатых графов потребуется максимально оптимизировать слой, связывающий два фреймворка, чтобы не препятствовать масштабируемости.

Поскольку WebGraph не предоставляет единого способа хранения свойств вершин/ребер, необходимо разработать абстракции, которые позволят TinkerPop получать доступ и вычислять значения этих свойств во время исполнения запросов.

Для анализа производительности потребуется  реализовать на Gremlin ряд содержательных запросов в определенном домене, и замерить время их выполнения. Сравнение с нативными реализациями запросов позволит оценить практическую пользу реализации.}

%%% Исходные материалы и пособия
\plannedsources{\begin{enumerate}
    \item документация реймворка для обработки графов Apache TinkerPop;
    \item документация фреймврока для сжатия графов WebGraph;
    \item документация Software Heritage.
\end{enumerate}}

%%% Цель исследования
\researchaim{Разработка удобного стилевого файла \LaTeX
             для бакалавров и магистров кафедры компьютерных технологий.}

%%% Задачи, решаемые в ВКР
\researchtargets{\begin{enumerate}
    \item реализация интерфейсов TinkerPop, позволяющих исполнять Gremlin запросы на графах, сжатых с использованием WebGraph;
    \item создание универсального механизма доступа к хранимым свойствам вершин и ребер, позволяющего использовать Gremlin запросы, опирающиеся на наличие/значения свойств;
    \item проведение анализа производительности реализации и сравнение с нативными реализациями запросов.
\end{enumerate}}

%%% Использование современных пакетов компьютерных программ и технологий
\addadvancedsoftware{Фреймворк \texttt{Apache TinkerPop}}{Список использованных источников}

%%% Краткая характеристика полученных результатов
\researchsummary{Разработана библиотека, позволяющая осуществлять немодифицрующие Gremlin запросы к графам, сжатым фреймворком WebGraph. Библиотека вклчает в себя поддержку различных источников свойств/вершин ребер, а также возможность определять собственные механизмы доступа к свойствам. Сформулирован ряд запросов в домене архивации данных систем контроля версий репозиториев с открытым исходным кодом, и проведен анализ производительности библиотеки на этих запросах.}

%%% Гранты, полученные при выполнении работы
\researchfunding{}

%%% Наличие публикаций и выступлений на конференциях по теме выпускной работы
\researchpublications{}

%% Эта команда генерирует титульный лист и аннотацию.
\maketitle{Бакалавр}

%% Оглавление
\tableofcontents

%% Макрос для введения. Совместим со старым стилевиком.
\startprefacepage

Графовое представление данных встречается все чаще, а увеличение размеров таких графов приводит к необходимости использовать системы, которые справляются с масштабируемостью. Для графов малых/средних размеров могут использоваться графовые базы данных, предоставляющие достаточную производительность, а также широкие возможности для анализа данных с помощью запросов. В случае больших графов (десятки миллиардов вершин, сотни миллиардов ребер) решением является сжатие графов. Такой подход позволяет добиться хорошей производительности, однако в данный момент предоставляет мало возможностей для анализа данных, т.к. API для доступа к вершинам и ребрам сжатого графа весьма лимитированный. Возможность осуществлять гибкие запросы к сжатым графам позволит удобным образом анализировать графы больших размеров.

%% Начало содержательной части.
\chapter{Обзор}

\section{Получение информации для графовых структур данных}

Многие задачи проедполагают хранение данынх в графовом представлении. Если пользователь хочет извлечь некую информацию (например расстояние между аэропортами), ему требуется выполнить некий запрос для этой структуры данных. Запрос может быть реализован нативно, то есть с использованием непосредствеено API низлежащей структуры. Такой подход не является гибким, так как требует ручной имплементации на каждый отдельный случай. Альтернатиовой являются доменно-ориентированные языки для обхода графов, повзоляющие формулировать гибкие запросы. Примером такого языка является язык Gremlin.

\section{Язык для обхода графов Gremlin}

Для исполнения запросов Gremlin использует библиотеку Apache TinkerPop. Любая система имеет возможносит реализовать инфраструктуру Apache TinkerPop (TinkerPop-enabled), что позволит исполнять в ней Gremlin запросы.
Примерами таких систем являются многие графовые базы данных.

\section{Ограничения графовых баз данных}

Для графов малых/средних такие базы данных предоставляют хорошую производительность. Однако для больших графов (десятки миллиардов вершин, сотни миллиардов ребер), для обеспечения хорошей производительности потребуется распределенная система со большими ресурсами. 

\section{Сжатие графов}

Другим подходом к обеспечению хорошей производительности при работе с большими графами является сжатие графов. Это позволяет эффективно разместить в памяти одной недорогой машины граф больших размеров, и анализировать его без использования распределенной системы. Примером такого фреймворка является WebGraph.

\section{Проблемы WebGraph}

Однако WebGraph предоставляет весьма лимитированный API для взаимодействия с графом. Таким образом, исполнение любого запроса на сжатом графе требует реализации вручную. Помимо этого, WebGraph не предоставляет универсаального API для работы со свойствами вершин и ребер. При этом многие представляющие интерес запросы зависят от значений свойств вершин и ребер, поэтому получение доступа к ним также становится обязанностью пользователя.

\section{Постановка задачи}\label{sec:task}

Целью работы является реализация TinkerPop инфраструктуры для фреймворка для сжатия графов WebGraph. Это позволит выполнять сложные запросы на больших графах, используя язык Gremlin. Кроме того, необходимо добавить возможность указывать сторонние источники свойств вершин/ребер. После этого требуется сформулировать ряд запросов, анализ проивзодительности исполнения которых покажет, насколько данный подход применим.

При этом, поскольку ключевое преимущество использования WebGraph перед графовыми базами данных, это возможность работать с большими графами на относительно слабой машине, реализация TinkerPop для WebGraph должна сохранить это преимущество. Поскольку TinkerPop предоставляет широкие возможности для обхода графов и в основном направлен на работу с графовыми базами данных, а WebGraph в свою очередь предоставляет весьма лимитированный API, фокусируясь на оптимизации памяти, потребуется максимально оптимизировать слой, связывающий эти два фреймворка.

\chapter{Подход к решению}

\section{Разбиение на подзадачи}

Для того, чтобы добиться поставленной задачи, потребуется:

\begin{enumerate}
    \item Реализовать интерфейсы Apache TinkepPop, превращающие WebGraph в TinkerPop-enabled систему
    \item Реализовать возможность указывать источники и способы доступа к свойствам вершин/ребер, для использования этих свойств в запросах
    \item Провести анализ производительности данной реализации
\end{enumerate}

\section{Реализация TinkerPop}

Для этого требуется реализовать для WebGraph интерфейсы пакета structure. Они включают в себя такие интерфейсы, как:
\begin{enumerate}
    \item Graph - основной интерфейс графа. Экземпляр позволяет получать доступ к вершинам и ребрам по идентификатору, либо ко всем сразу.
    \item Vertex - интерфейс вершины графа. Позволяет получить входящие/исхдящие вершины/ребра, а также доступные свойства
    \item Edge - интерфейс ребра графа. Позволяет получить входящие исходящие вершины, а также доступные свойства по уникальному ключу.
    \item Property - интерфейс свойства вершин/ребер. Предоставляет доступ к значениям свойств.
\end{enumerate}
Помимо описанных методов, TinkerPop поддерживает модифицирующие граф запросы. В данной работе эта возможность реализоваываться не будет. Также TinkerPop поддерживает мета-свойства для вершин - свойства вершин становятся элементами графа наравне с вершинами и ребрами. Это возможность также реализовываться не будет.

Поскольку данная реализация нацелена на случай, в котором пользователь уже использует фреймворк WebGraph, а значит располагает представлением сжатого графа, и уже имеет возможность исполнять на нем нативные запросы, однако хочеть получить возможность исполнять запросы и на Gremlin, следует рассматривать реализацию как библиотеку, получающую в том или ином виде сжатый WebGraph граф, и предоставляющаую таким образом возможность исполнять на нем запросы на Gremlin, делегируя описанные выше методы низлежащему сжатому графу, с добавлением требуемой пред- и пост-обработки аргументов и результатов.

Как было описано выше TinkerPop предоставляет абстракции для вершин и ребер и работает с их экземплярами. WebGraph в свою очередь, предоставляет доступ к вершинам, ссылаясь на их уникальный числовой идентификатор. Располагая индексом вершины можно получить итератор индексов вершин-соседей. Это означает, что для реализации прослойки потребутеся создавать объекты-обертки. Здесь можно рассматривать два подхода:
\begin{enumerate}
    \item Сопоставить каждой вершине (ребру) единственный объект, который будет возвращаться при любом доступе к данной вершине.
    \item Возвращать временные копии объекты при доступе к данной вершине - два различных запроса к одной вершине могут вернуть различные объекты, но с одинаковыми свойствами.
\end{enumerate}

Первый вариант подразумаеват создание единого реестра объектов, для получения гарантии идентичности возвращаемых объектов при различных запросах. Учитывая цель сохранить преимущество в использованиии памяти, получаемое за счет сжатия графа, этот подход не является лучшим выбором, так как создает дополнительную нагрузку на память, которая при участиии в обходе достаточного числа вершин, станет существенной проблемой.
Второй подход в свою очередь удобен своей гибкостью. Оставляя возможность создавать новые объекты при каждом новом обращении к вершине, он не исключает возможности внесения оптимизаций, для уменьшения общего числа аллокаций новых объектов.

\section{Реализация доступа к свойствам}

Вершины и ребра в графе могу тобладать свйоствами (например название аэропорта). Так как многие (если не большинство) запросов представляют интерес именно в привязке к свойствам графа, а не исключительно по его топологии, Gremlin предоставляет возможность формулировать запросы, зависящие от свойств. Свойства устроены как пара ключ-значение, где ключом является строка, а значением объект. Gremlin позволяет как проверять наличие свойства с данным ключом у данной вершины/ребра, так и получать его значение, а также использовать это значение, например для фиьтрации. TinkerPop в свою очередь предоставляет интерфейс Property, который используется для получение доступа к свойствам даннйо вершины/реабра.

WebGraph - фреймворк, сжимающий графы с точки зрения их структуры. WebGraph предоставляет единсвтенный способ работы со свойствами - по индексу вершины можно получить как индексы его соседей, так и индексы соседей с 'метками'. Эти метки можно считать свойством ребра - для каждого ребра можно хранить единственный объект метку. В осталтном работа со свойствами перекладывается на пользователя, в частности свойства вершин, хранение нескольких свойств для ребер.
При этом существует ряд стандартных практик, использующихся для хранения и получения доступа к свойствам. Для вершин может использоваться сериализация массива примитивов, в котором индекс соответвсует индексу вершины, а значение по индексу - значению свойства для вершины. Для того, чтобы пользовтель имел возмодность удобным образом задавать спсооб доступа к свойствам вершин и ребер, следует реализовать ряд классов, позволяющих как использовать стандартные методы хранения свойста, так и пользовательсике способы хранения свойств.

\section{Анализ производительности реализации}

При связке этих двух фреймворков могут возникнуть проблемы с производительностью - требуется как сохранить малый отпечаток в памяти, достигаемый сжатием графа, так и снизить накладные расходы, которые появляются при адаптации WebGraph к TinkerPop.
Для анализа производительности следует выбрать конкретный набор данных, представленнных в виде графа. Следует определить ряд запросов, представляющих на нем интерес. Затем требуется реализовать данные запросы на языке Gremlin, и, используя сжатое WebGraph представление данного графа, исполнить данные запросы, после чего проанализировать результаты по ряду метрик, таких как: время выполнения, используемая память, число вершин/ребер, затронутых в процессе исполнения, число результатов.
В качестве такого набора данных будет использоваться архив Software Heritage - данные систем контроля версий репозиториев с открытым исходным кодом. Графовое представление обусловлено архивацией данных распределенных систем контроля версий данных проектов, базирующихся на дереве хешей (точнее сказать не дерево, а ориентированный ациклический граф). Он содержит информацию о более чем 1 милларде коммитов из более чем 80 миллионов репозиториев. Для непсредственного тестирования будет использоваться часть полного архива, а именно python3k, содержащий данные о 3 тысячах популярных репозиториев на языке python. Граф насчитывает 46 миллионов вершин и 1.2 миллиарда ребер.

\chapter{Реализация}

\section{Реализация TinkerPop}

\end{document}
